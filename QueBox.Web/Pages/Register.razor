@page "/register"
@using QueBox.Services
@using QueBox.Models

@inject UsuarioService UsuarioService
@inject IJSRuntime JS

<PageTitle>QueBox</PageTitle>

<h1>Registrarse en QueBox</h1>

<EditForm class="row g-3 " Model="@editingUsuario" OnValidSubmit="SaveUsuario">

    <DataAnnotationsValidator />
    <ValidationSummary />

    <div class="mb-3 col-md-6">
        <label for="nombre" class="form-label">Nombre:</label>
        <InputText @bind-Value="editingUsuario.Nombre" id="nombre" class="form-control" />
    </div>

    <div class="mb-3 col-md-6">
        <label for="clave" class="form-label">Clave:</label>
        <InputText @bind-Value="editingUsuario.Clave" id="clave" class="form-control" />
    </div>

    <div class="mb-3 col-md-12">
        <label for="correo" class="form-label">Correo:</label>
        <InputText @bind-Value="editingUsuario.Correo" id="correo" class="form-control" />
    </div>

    <button type="submit" class="col-md-4 btn btn-primary">Submit</button>



</EditForm>

@code {

    private List<Usuario> usuarios = new();
    private Usuario? editingUsuario;

    protected override async Task OnInitializedAsync()
    {
        editingUsuario = new Usuario();
        usuarios = await UsuarioService.GetUsuariosAsync();
    }

    private async Task SaveUsuario()
    {
        if (editingUsuario == null)
            return;

        if (editingUsuario.Id_Usuario == 0)
        {
            var created = await UsuarioService.CreateUsuarioAsync(editingUsuario);
            if (created != null)
                usuarios.Insert(0, created);
        }
        else
        {
            await UsuarioService.UpdateUsuarioAsync(editingUsuario);
            var index = usuarios.FindIndex(u => u.Id_Usuario == editingUsuario.Id_Usuario);
            if (index >= 0)
                usuarios[index] = editingUsuario;
        }

        editingUsuario = null;
        StateHasChanged();
    }

}